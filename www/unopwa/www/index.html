<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <!--
  Customize this policy to fit your own app's needs. For more guidance, see:
      https://github.com/apache/cordova-plugin-whitelist/blob/master/README.md#content-security-policy
  Some notes:
      * gap: is required only on iOS (when using UIWebView) and is needed for JS->native communication
      * https://ssl.gstatic.com is required only on Android and is needed for TalkBack to function properly
      * Disables use of inline scripts in order to mitigate risk of XSS vulnerabilities. To change this:
          * Enable inline JS: add 'unsafe-inline' to default-src
  -->
  <meta http-equiv="Content-Security-Policy" content="default-src * 'self' 'unsafe-inline' 'unsafe-eval' data: gap: content:">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="theme-color" content="#2196f3">
  <meta name="format-detection" content="telephone=no">
  <meta name="msapplication-tap-highlight" content="no">
  <title>UNO Mobile</title>

  <link rel="stylesheet" href="css/framework7.min.css">
  <link rel="stylesheet" href="css/icons.css">
  <link rel="stylesheet" href="css/app.css">
  <link rel="stylesheet" href="css/print.min.css">

  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="mask-icon" href="safari-pinned-tab.svg" color="#264de4">
  <meta name="msapplication-TileColor" content="#ffc40d">
  <meta name="theme-color" content="#264de4">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <link rel="apple-touch-startup-image" href="apple-touch-icon.png">
  <!-- iOS Splash Screen Images -->
  <link rel="apple-touch-startup-image" href="apple-splash-640.png" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
  <link rel="apple-touch-startup-image" href="apple-splash-750.png" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
  <link rel="apple-touch-startup-image" href="apple-splash-1242.png" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
  <link rel="apple-touch-startup-image" href="apple-splash-1125.png" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
  <link rel="apple-touch-startup-image" href="apple-splash-1536.png" media="(min-device-width: 768px) and (max-device-width: 1024px) and (-webkit-min-device-pixel-ratio: 2) and (orientation: portrait)">
  <link rel="apple-touch-startup-image" href="apple-splash-1668.png" media="(min-device-width: 834px) and (max-device-width: 834px) and (-webkit-min-device-pixel-ratio: 2) and (orientation: portrait)">
  <link rel="apple-touch-startup-image" href="apple-splash-2048.png" media="(min-device-width: 1024px) and (max-device-width: 1024px) and (-webkit-min-device-pixel-ratio: 2) and (orientation: portrait)">


</head>
<body>


  <div id="app">

    <!-- Status bar overlay for fullscreen mode-->
    <div class="statusbar"></div>
    <!-- Left panel with cover effect can add theme-dark-->
    <div class="panel panel-left panel-cover">
      <div class="view">
        <div class="page">
          <div class="navbar">
            <div class="navbar-inner">
              <div class="title">Menu</div>
            </div>
          </div>


          <div class="page-content">
            <div class="col-50 colMenu">
              <button onclick="UpdateDatabase()" class="col button button-big2 button-raised my-stock color-green">
                <i class="f7-icons size-25">refresh_round_fill</i>
                Update Database
              </button>
              Update Database
            </div>
            <div class="list links-list">
              <ul>
                <!--<li>
    <a href="/salesinvoice/" class="panel-close">
      <i class="f7-icons size-22 color-blue">money_dollar_fill</i>
      <div class="item-inner">
        <div class="item-title">New Invoice</div>
      </div>
    </a>
  </li>-->

                <li>
                  <a href="/barcode/" class="panel-close">
                    <i class="f7-icons size-22 color-blue">navigation_fill</i>
                    <div class="item-inner">
                      <div class="item-title">Barcode Test</div>
                    </div>
                  </a>
                </li>
                <li>
                  <a href="/mylocation/" class="panel-close">
                    <i class="f7-icons size-22 color-blue">navigation_fill</i>
                    <div class="item-inner">
                      <div class="item-title">My location</div>
                    </div>
                  </a>
                </li>
                <li>
                  <a href="/printsettings/" class="panel-close">
                    <i class="f7-icons size-22 color-blue">settings_fill</i>
                    <div class="item-inner">
                      <div class="item-title">Print Settings</div>
                    </div>
                  </a>
                </li>
                <li>
                  <a href="/printtest/" class="panel-close">
                    <i class="f7-icons size-22 color-blue">document_text</i>
                    <div class="item-inner">
                      <div class="item-title">Print Test</div>
                    </div>
                  </a>
                </li>
                <li>
                  <a href="/createcustomer/" class="panel-close">
                    <i class="f7-icons size-22 color-blue">box_fill</i>
                    <div class="item-inner">
                      <div class="item-title">Create customer</div>
                    </div>
                  </a>
                </li>
                <li>
                  <a href="/CheckInOut/" class="panel-close">
                    <i class="f7-icons size-22 color-blue">box_fill</i>
                    <div class="item-inner">
                      <div class="item-title">Check In/Out</div>
                    </div>
                  </a>
                </li>


              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Right panel with reveal effect-->
    <div class="panel panel-right panel-reveal theme-dark">
      <div class="view">
        <div class="page">
          <div class="navbar">
            <div class="navbar-inner">
              <div class="title">Right Panel</div>
            </div>
          </div>
          <div class="page-content">
            <div class="block">Right panel content goes here</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Views/Tabs container -->
    <div class="views tabs ios-edges">
      <!-- Tabbar for switching views-tabs -->
      <div class="toolbar tabbar-labels toolbar-bottom-md">
        <div class="toolbar-inner">
          <a href="#view-home" class="tab-link tab-link-active">
            <i class="icon f7-icons ios-only">home</i>
            <i class="icon f7-icons ios-only icon-ios-fill">home_fill</i>
            <i class="icon material-icons md-only">home</i>
            <span class="tabbar-label">Home</span>
          </a>
          <a href="#view-catalog" class="tab-link">
            <i class="icon f7-icons ios-only">list</i>
            <i class="icon f7-icons ios-only icon-ios-fill">list_fill</i>
            <i class="icon material-icons md-only">view_list</i>
            <span class="tabbar-label">Tasks</span>
          </a>
          <a href="#view-settings" class="tab-link">
            <i class="icon f7-icons ios-only">settings</i>
            <i class="icon f7-icons ios-only icon-ios-fill">settings_fill</i>
            <i class="icon material-icons md-only">settings</i>
            <span class="tabbar-label">Settings</span>
          </a>
        </div>
      </div>
      <!-- Your main view/tab, should have "view-main" class. It also has "tab-active" class -->
      <div id="view-home" class="view view-main tab tab-active">
        <!-- Page, data-name contains page name which can be used in page callbacks -->
        <div class="page" data-name="home">
          <!-- Top Navbar -->
          <div class="navbar">
            <div class="navbar-inner">
              <div class="left">
                <a href="#" class="link icon-only panel-open" data-panel="left">
                  <i class="icon f7-icons ios-only">menu</i>
                  <i class="icon material-icons md-only">menu</i>
                </a>
              </div>
              <div class="title sliding">Home</div>
              <div class="right">
                <a href="#" class="link icon-only panel-open" data-panel="right">
                  <i class="icon f7-icons ios-only">menu</i>
                  <i class="icon material-icons md-only">menu</i>
                </a>
              </div>
            </div>
          </div>


          <!-- Scrollable page content-->
          <div class="page-content">
            <div class="card">
              <div class="card-content card-content-padding">
                Unopwa App. version:
                <span id="CacheVersion" class="badge color-blue">
                </span>
              </div>
            </div>
            
            <div class="row">
              <div class="col-50 colMenu">
                <button onclick="newInvoice()" class="col button button-big2 button-raised">
                  <i class="f7-icons size-25">money_dollar_fill</i>Invoice
                </button>
                Add New invoice
              </div>
              <div class="col-50 colMenu">
                <button onclick="newOrder()" class="col button button-big2 button-raised new-order">
                  <i class="f7-icons size-25">drawer_fill</i>Order
                </button>
                Add New order
              </div>
            </div>

            <div class="row">
              <div class="col-50 colMenu">
                <button onclick="salesreturn()" class="col button button-big2 button-raised my-stock">
                  <i class="f7-icons size-25">refresh_round_fill</i>
                  Return
                </button>
                New Sales Return
              </div>
              <div class="col-50 colMenu">
                <button onclick="newDamageInvoice()" class="col button button-big2 button-raised">
                  <i class="f7-icons size-25">money_dollar_fill</i>Damage
                </button>
                Damage Invoice
              </div>

            </div>

            <div class="row">
              <div class="col-50 colMenu">
                <button onclick="invoiceList()" class="col button button-big2 button-raised">
                  <i class="f7-icons size-25">drawers_fill</i>Invoices
                </button>
                view all invoices
              </div>
              <div class="col-50 colMenu">
                <button onclick="newReceiptVoucher()" class="col button button-big2 button-raised">
                  <i class="f7-icons size-25">favorites_fill</i>Receipt
                </button>
                Add new Voucher
              </div>
            </div>

            <div class="row">
              <div class="col-50 colMenu">
                <button onclick="stockList()" class="col button button-big2 button-raised">
                  <i class="f7-icons size-25">box_fill</i>
                  My Stock
                </button>
                view current warehouse stock
              </div>

              <div class="col-50 colMenu">
                <button onclick="stocksearch()" class="col button button-big2 button-raised">
                  <i class="f7-icons size-25">box_fill</i>
                  Stock search
                </button>
                view current stock details
              </div>


            </div>

            <div class="row">
              <div class="col-50 colMenu">
                <button onclick="UploadData()" class="col button button-big2 button-raised my-stock" disabled>
                  <i class="f7-icons size-25">cloud_upload_fill</i>
                  Sync Data
                </button>
                Upload offline invoices
              </div>
              <div class="col-50 colMenu">
                <button onclick="openCustomerlist()" class="col button button-big2 button-raised">
                  <i class="f7-icons size-25">person_fill</i>Customers
                </button>
                view customer list
              </div>
            </div>

            <div class="row">
              <div class="col-50 colMenu">
                <button onclick="RefreshApp()" class="col button button-big2 button-raised color-green">
                  <i class="f7-icons size-25">refresh_round_fill</i>Refresh
                </button>
                Refresh App
              </div>

              <div class="col-50 colMenu">
                <button onclick="Damagelist()" class="col button button-big2 button-raised">
                  <i class="f7-icons size-25">box_fill</i>
                  Damage stock
                </button>
                view Damage stock
              </div>
            </div>

            <div class="row">
              <div class="col-50 colMenu">
                <button onclick="VouchersList()" class="col button button-big2 button-raised">
                  <i class="f7-icons size-25">home_fill</i>Vouchers List
                </button>
                view Vouchers list
              </div>
            </div>
              

            </div>
          </div>
      </div>

      <!-- Catalog View -->
      <div id="view-catalog" class="view tab">
        <!-- Catalog page will be loaded here dynamically from /catalog/ route -->
      </div>

      <!-- Settings View -->
      <div id="view-settings" class="view tab">
        <!-- Settings page will be loaded here dynamically from /settings/ route -->
      </div>
    </div>

    <!-- Popup -->


    <!-- Login Screen -->

  </div>


  <!-- Framework7 library -->
  <script src="js/framework7.min.js"></script>

  <!-- App routes -->
  <script src="js/routes.js"></script>

  <!-- indexDB promise lib https://github.com/jakearchibald/idb-->
  <script src="js/idb.js"></script>


  <!-- Your custom app scripts -->
  <script src="js/app.js"></script>

  <script src="js/invoice.js"></script>

  <script src="js/print.min.js"></script>

  <script>
    var $$ = Dom7;


    function newInvoice() {
        homeView.router.navigate('/salesinvoice/');
    };


    function newDamageInvoice() {
      homeView.router.navigate('/Damageinvoice/');
    };

    function newReceiptVoucher() {
      homeView.router.navigate('/ReceiptVoucher/');
    };

    function newOrder() {
        homeView.router.navigate('/orderinvoice/');
    };

    function salesreturn() {
        homeView.router.navigate('/returninvoice/');
    };

    function stockList() {
        //app.views.current.router.navigate('/stocklist/');
        homeView.router.navigate('/stocklist/');
    };

    function stocksearch() {
      //app.views.current.router.navigate('/stocklist/');
      homeView.router.navigate('/stocksearch/');
    };

    function Damagelist() {
      //app.views.current.router.navigate('/stocklist/');
      homeView.router.navigate('/Damagelist/');
    };


    function VouchersList() {
      //app.views.current.router.navigate('/stocklist/');
      homeView.router.navigate('/VouchersList/');
    };

    function invoiceList() {
      homeView.router.navigate('/invoiceList/');
    };

    function stockCube() {
      homeView.router.navigate('/stockcube/');
    };



    function openCustomerlist() {
      //app.views.main.router.navigate('/customerlist/');
      app.views.current.router.navigate('/customerlist/');
    };
    //warehouse-list
    //$$('.warehouse-list').on('click', function () {
    function openWarehouse() {
      //console.log(app.views.current.router.currentRoute);
      //app.views.current.router.navigate('/warehouselist/');
      homeView.router.navigate('/warehouselist/');
    };

    async function UpdateDatabase() {
      //bIsOffline = await IsInvoiceOffline();
     // console.log(bIsOffline);
     bIsOffline = await checkoffline() ;
      if (bIsOffline === true) {
        app.dialog.alert("Please upload your Invoices !!. Pending upload exists!!");
        return;
      }
        if (localStorage.getItem('PendingUploads') === "0") {


          app.dialog.confirm('You current database will be overwritten! Are you sure?', function () {
            app.methods.NewDatabase();
          });
        } else {
          app.dialog.alert("Please upload your data!!. Pending upload exists!!");
        }
    

      
    }

    function RefreshApp() {
        window.location.reload();
    }

    function CreateCustomer() {
      homeView.router.navigate('/createcustomer/');
    }

    function CheckInOut() {
      homeView.router.navigate('/CheckInOut/');
    }

    document.addEventListener("DOMContentLoaded", function(event) {
        $$("#CacheVersion").text(localStorage.getItem("CacheVersion"));
    });


    // Sync Data
    async function UploadData() {
      let invoice = [];
      let invoiceList = await getInvoiceList();
      app.dialog.alert("Upload your offline invoices !!... "); 
        if (localStorage.getItem("UpdateDataToOnlineServer") === "1") {
          for (var inv in invoiceList) {
            if (invoiceList[inv]["IsUploaded"] === false) {
              // Get the current invoice key
              const invID = invoiceList[inv]['PK_key']; // Current int invoice_id
              let lst_edit_invoice = await getInvoice(invID);
              for (var inv in lst_edit_invoice) {
                invoice.push(lst_edit_invoice[inv]);
             
              }
              //console.log(invoice);
          
              SaveEditedInvoice(invID, invoice);
              invoice = [];
            }
          }
     
        }        
    }


    async function checkoffline() {
      const invoice = [];
      var isOffline = false;
      let invoiceList = await getInvoiceList();
      for (var inv in invoiceList) {
        if (invoiceList[inv]["IsUploaded"] === false) {
          isOffline = true;

        }
      }
      return isOffline
    }
    async function UploadDataauto() {
      let invoice = [];
      let invoiceList = await getInvoiceList();
      
      if (localStorage.getItem("UpdateDataToOnlineServer") === "1") {
        for (var inv in invoiceList) {
          if (invoiceList[inv]["IsUploaded"] === false) {
            // Get the current invoice key
            const invID = invoiceList[inv]['PK_key']; // Current int invoice_id
            let lst_edit_invoice = await getInvoice(invID);
            for (var inv in lst_edit_invoice) {
              invoice.push(lst_edit_invoice[inv]);

            }
            //console.log(invoice);

            SaveEditedInvoice(invID, invoice);
            invoice = [];
          }
        }

      }
    }
    

  </script>



  <script async defer
          src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAPlc7h1dWlFpst6z7-dlomP4CRdgrevwc">
  </script>



</body>
</html>
